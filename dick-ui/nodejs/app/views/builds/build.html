<section>
    <section class="panel">
        <header class="panel-heading" ng-controller="HookController">

            <div>
                <span class="text-muted">Current stage: </span>{{build.currentStage}}
            </div>

            <div class="row pd-md">
                <div ng-repeat="stage in build.stages"
                     ng-class="{'col-lg-12' : build.stages.length === 1,
                 'col-lg-6' : build.stages.length === 2,
                 'col-lg-4' : build.stages.length === 3,
                 'col-lg-3' : build.stages.length > 3,
                 'col-md-12' : build.stages.length === 1,
                 'col-md-6' : build.stages.length === 2,
                 'col-md-4' : build.stages.length > 2}"
                >
                    <div class="row">
                        <div class="mg-b-xs">
                            <button data-toggle="button" class="btn btn-white btn-xs" title="restart"
                                    ng-click="rebuildStage(build, stage)">
                                <i class="fa fa-refresh"></i>
                            </button>
                            {{stage.name}}
                        </div>
                        <div class="progress mg-r-xs"
                             ng-class="{'box-shadow': stage.name === build.currentStage}">
                            <div class="progress-bar progress-bar-striped"
                                 ng-class="{'progress-bar-success': stage.status === 'DEPLOYED' || stage.status === 'DEPLOYED_STAGE',
                        'progress-bar-warning': stage.status === 'STOPPED',
                        'progress-bar-danger': stage.status === 'FAILED',
                        'active': stage.status === 'IN_PROGRESS'
                     }"
                                 role="progressbar" aria-valuenow="{{stage.status === 'READY' ? 0 : 100}}"
                                 aria-valuemin="0" aria-valuemax="100"
                                 style="width: {{stage.status === 'READY' ? 0 : 100}}%"
                                 title="{{stage.name}}">

                                <a href="/{{build.project.namespace}}/{{build.project.name}}/{{build.id}}/{{stage.name}}"
                                   class="text-white pull-left mg-l-sm">
                                    <i class="fa fa-external-link-square"></i>
                                </a>

                                <a href="#" class="text-white" ng-click="kill(build)"
                                   ng-show="stage.status === 'IN_PROGRESS'">
                                    <i class="fa fa-pause"></i>
                                </a>
                                <a href="#" ng-click="buildStage(build, stage)" class="text-white pull-right mg-r-sm"
                                   ng-show="stage.status === 'DEPLOYED_STAGE'">
                                    <i class="fa fa-forward"></i>
                                </a>

                                <a href="#" ng-click="buildFirstStage(build)" class="text-white mg-l-sm"
                                   ng-show="build.currentStage === null && $first">
                                    <i class="fa fa-forward"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>


        <div class="panel-body">
            <loader on="build"></loader>

            <div ng-show="build">
                <div class="list-group col-md-2">
                    <div href="#" class="list-group-item active">
                        Jobs in {{stage.name}}
                    </div>
                    <a href="#" ng-click="selectJob(job)" class="list-group-item"
                       ng-repeat="job in stage.jobBuilds track by job.id">
                        <span class="badge" ng-class="{
                        'text-success': job.status === 'DEPLOYED',
                        'text-danger': job.status === 'FAILED',
                        'text-info': job.status === 'IN_PROGRESS',
                        'text-warning': job.status === 'STOPPED'
                        }" ng-bind-html="job.status | jobStatusIcon"></span>
                        {{job.name}}
                        <div class="text-muted">{{job.status | jobStatus}}</div>
                    </a>
                </div>

                <div class="col-md-10 ">
                    <div class="panel box-shadow">
                        <header class="panel-heading">
                            {{job.name}}
                            <span class="text-muted">console log</span>
                        </header>
                        <div class="panel-body">
                            <div class="text-center text-muted"
                                 ng-show="job.status === 'READY' || job.status === 'WAITING'">
                                Not started yet.
                            </div>
                            <div ng-hide="job.status === 'READY' || job.status === 'WAITING'">
                                <loader on="output"></loader>
                                <div ng-show="job.status === 'IN_PROGRESS'">
                                <span ng-repeat="chunk in output"
                                      style="white-space: pre;">{{chunk.output}}&#10;</span>
                                    <i class="fa fa-spinner fa-spin"></i>
                                </div>
                                <span ng-hide="job.status === 'IN_PROGRESS'"
                                      style="white-space: pre;">{{output.output}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>